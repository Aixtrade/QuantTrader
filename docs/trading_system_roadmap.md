# 交易系统路线图与改进计划

## 1. 目的与范围
- 本文结合《交易系统核心模块需求规范》，用于指导按 MVP 分期落地与迭代。
- 聚焦架构合理性、非功能指标、风控与可观测性补强，兼顾策略加载安全和数据质量。

## 2. 改进清单（需纳入设计与实现）
- 非功能与可观测性：明确延迟/吞吐/QPS、可用性目标；日志/指标/Tracing 三件套；缓存命中率、重试次数、WS 断线重连与退避策略。
- 数据质量与时间同步：缺失/重复/乱序数据处理；UTC 对齐精度；回测与实时数据一致性校验；缓存淘汰策略（TTL/容量/LRU）。
- 风控完善：补全仓位占比检查 `_check_position_ratio`；风险阈值与动作优先级/冲突处理；区分回测与实时的风控策略与触发动作。
- 交易成本与模型：滑点、手续费、资金费率、清算/强平模型参数化；批量撮合与部分成交模拟。
- 策略加载安全：热重载回滚、版本元数据、签名/白名单、隔离执行（进程/容器）、资源限制与异常防护。
- 报告与指标假设：年化/波动率/夏普等计算的日历与无风险利率假设；多标的/多策略组合支持；分资产/分策略维度统计。
- 配置与密钥管理：分环境配置（dev/stage/prod）、环境变量命名规范，密钥安全存储与注入。

## 3. MVP 分阶段实施与验收
- **MVP v0：单标的回测闭环**
  - 目标：可加载单策略，跑通事件合约/永续回测，产出基础报告。
  - 范围：BaseStrategy/StrategyLoader（无热重载）、StrategyContext/Signal/Result，FuturesTrader/EventsTrader 最小成交逻辑，FuturesSimulatedAccount/SimulatedAccount，Playback 回测（含暂停/恢复/速度控制基础版），DataCenterService 简单 HTTP+缓存，RiskManager 仅最大回撤&日亏损，ReportGenerator 基础收益/回撤/胜率统计。
  - 验收：给定 BTCUSDT 1m 历史数据，可跑完整区间，生成权益曲线与交易记录。
- **MVP v1：实时纸交易与多策略管理**
  - 目标：RealtimeEngine Paper 模式，WebSocket 数据流接入；策略热重载与信号冲突处理；风险预警。
  - 范围：StrategyLoader 热重载/版本元数据；CompositeStrategy 信号聚合（vote/first）；SignalFilterConfig 应用；RealtimeEngine 事件驱动；RiskManager 警告→强平；DataHub 缓存 TTL/淘汰；时间同步与 K 线对齐。
  - 验收：实时订阅单标的，策略可热重载，信号推送与纸面成交正确，风控可触发警告/强平。
- **MVP v2：资金费率与批量优化**
  - 目标：永续资金费率结算，批量回测推送优化，高速 Playback。
  - 范围：资金费率结算逻辑；批量推送阈值与滑动窗口；滑点/手续费模型可配置；TA-Lib 指标预计算服务接入。
  - 验收：高速回测模式下性能稳定，资金费率对权益影响正确。
- **MVP v3：多资产多策略组合与报告增强**
  - 目标：多标的/多策略组合回测与实时；组合级风控；报告多维统计。
  - 范围：HedgePositionManager 完善；组合风控（总仓位/单策略/单标的）；报告分资产、分策略维度；月度/日度收益表。
  - 验收：多标的组合回测可执行，报告可分层查看。
- **MVP v4：实盘接口与安全可观测性**
  - 目标：接入交易所 REST/WS，Live 模式最小可用；安全与可观测性完善。
  - 范围：API 限速与重试、熔断；密钥管理/签名；下单/撤单/查询；日志、指标、Tracing；策略隔离与权限收敛。
  - 验收：沙盒/小额账户下单成功，风控可阻断危险操作，可观测指标可用。

## 4. 近期优先行动
- 补充非功能与可观测性指标，并形成监控项列表。
- 明确时间同步、数据质量（缺失/重复/乱序）的处理策略，落地缓存淘汰方案。
- 完善风控仓位检查与风险动作优先级；区分回测/实时的风控行为。
- 定义滑点、手续费、资金费率、清算/强平的默认参数与可配置项。
- 为策略加载制定安全边界（签名/白名单/隔离/限权），并设计热重载回滚流程。
- 补充报告计算假设（无风险利率、日历、波动率窗口）与多资产/多策略支持计划。

## 5. 对齐点（需要外部确认）
- 无风险利率、交易日历与年化/波动率计算假设。
- API 限速策略与重试/退避参数；WS 断线重连策略。
- 环境划分与环境变量命名规范；密钥管理方案。
- 策略包发布、签名与审核流程，隔离级别（进程/容器/权限）。
